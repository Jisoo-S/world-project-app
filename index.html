<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ì˜ ì—¬í–‰ ì•„ì¹´ì´ë¸Œ - ì™„ë²½í•œ ì‹¤ì œ ì§€êµ¬ë³¸</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 25%, #334155 50%, #1e293b 75%, #0f172a 100%);
            overflow: hidden;
            height: 100vh;
        }
        
        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            text-align: center;
            z-index: 100;
            background: rgba(0, 0, 0, 0.8);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .spinner {
            border: 4px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top: 4px solid #3b82f6;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .ui-panel {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 20px;
            z-index: 50;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header {
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }
        
        .header h1 {
            color: #1e293b;
            font-size: 26px;
            font-weight: 800;
            margin: 0;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stats {
            top: 20px;
            right: 20px;
            min-width: 240px;
        }
        
        .stats h3 {
            color: #1e293b;
            margin-bottom: 16px;
            font-size: 18px;
            font-weight: 700;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }
        
        .color-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .controls {
            bottom: 20px;
            right: 20px;
        }
        
        .control-btn {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 10px;
            margin: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .control-btn:hover {
            background: linear-gradient(135deg, #2563eb, #5b21b6);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }
        
        .control-btn:active {
            transform: translateY(0px);
        }
        
        .country-info {
            bottom: 20px;
            left: 20px;
            min-width: 320px;
            max-height: 420px;
            overflow-y: auto;
            display: none;
        }
        
        .country-info h3 {
            color: #1e293b;
            margin-bottom: 16px;
            font-size: 20px;
            font-weight: 700;
            border-bottom: 3px solid #3b82f6;
            padding-bottom: 8px;
        }
        
        .trip-item {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            padding: 16px;
            margin: 10px 0;
            border-radius: 12px;
            border-left: 5px solid #3b82f6;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }
        
        .trip-item:hover {
            transform: translateX(4px);
        }
        
        .trip-location {
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 6px;
            font-size: 16px;
        }
        
        .trip-date {
            color: #64748b;
            font-size: 14px;
            font-weight: 500;
        }
        
        .close-btn {
            position: absolute;
            top: 12px;
            right: 18px;
            background: none;
            border: none;
            font-size: 24px;
            color: #64748b;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        
        .close-btn:hover {
            color: #ef4444;
        }
        
        .usage-guide {
            top: 110px;
            left: 20px;
            max-width: 300px;
            font-size: 13px;
        }
        
        .loading-status {
            color: #60a5fa;
            font-size: 16px;
            margin-top: 12px;
            font-weight: 500;
        }
        
        /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
        .country-info::-webkit-scrollbar {
            width: 6px;
        }
        
        .country-info::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        .country-info::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .country-info::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="loading">
            <div class="spinner"></div>
            <p style="font-size: 20px; font-weight: 600; margin-bottom: 8px;">ì‹¤ì œ ì§€êµ¬ë³¸ì„ ìƒì„±í•˜ëŠ” ì¤‘...</p>
            <div class="loading-status" id="loadingStatus">ì´ˆê¸°í™” ì¤‘...</div>
        </div>
        
        <div class="ui-panel header">
            <h1>ğŸŒ ë‚˜ì˜ ì—¬í–‰ ì•„ì¹´ì´ë¸Œ</h1>
        </div>
        
        <div class="ui-panel stats">
            <h3>ğŸ“Š ì—¬í–‰ í†µê³„</h3>
            <div class="stat-item">
                <div class="color-dot" style="background: #10b981;"></div>
                <span>1íšŒ ë°©ë¬¸: 3ê°œêµ­</span>
            </div>
            <div class="stat-item">
                <div class="color-dot" style="background: #f59e0b;"></div>
                <span>2íšŒ ë°©ë¬¸: 1ê°œêµ­</span>
            </div>
            <div class="stat-item">
                <div class="color-dot" style="background: #3b82f6;"></div>
                <span>3íšŒ ë°©ë¬¸: 1ê°œêµ­</span>
            </div>
            <div class="stat-item">
                <div class="color-dot" style="background: #ef4444;"></div>
                <span>4íšŒ+ ë°©ë¬¸: 1ê°œêµ­</span>
            </div>
        </div>
        
        <div class="ui-panel controls">
            <div style="margin-bottom: 12px; font-weight: 700; color: #1e293b; font-size: 16px;">ğŸ® ì§€êµ¬ë³¸ ì¡°ì‘</div>
            <button class="control-btn" onclick="resetView()">ğŸ  í™ˆìœ¼ë¡œ</button>
            <button class="control-btn" onclick="toggleAnimation()" id="animationBtn">â¸ï¸ ì •ì§€</button>
            <button class="control-btn" onclick="toggleCountries()" id="countryBtn">ğŸ—ºï¸ ê²½ê³„ì„ </button>
        </div>
        
        <div class="ui-panel country-info" id="countryInfo">
            <button class="close-btn" onclick="closeCountryInfo()">Ã—</button>
            <h3 id="countryName">êµ­ê°€ ì •ë³´</h3>
            <div id="tripsList"></div>
        </div>
        
        <div class="ui-panel usage-guide">
            <div style="color: #1e293b; font-weight: 700; margin-bottom: 8px;">ğŸ’¡ ì‚¬ìš©ë²•</div>
            <div style="color: #475569; line-height: 1.5;">
                â€¢ <strong>ë§ˆìš°ìŠ¤ ë“œë˜ê·¸</strong>ë¡œ ì§€êµ¬ë³¸ íšŒì „<br>
                â€¢ <strong>íœ </strong>ë¡œ í™•ëŒ€/ì¶•ì†Œ<br>
                â€¢ <strong>ë¹¨ê°„ ë§ˆì»¤ í´ë¦­</strong>ìœ¼ë¡œ ì—¬í–‰ê¸°ë¡ ë³´ê¸°<br>
                â€¢ <strong>ğŸ—ºï¸ ë²„íŠ¼</strong>ìœ¼ë¡œ ë‚˜ë¼ ê²½ê³„ì„  í† ê¸€<br>
                â€¢ <strong>ë§ˆì»¤ê°€ ì§€êµ¬ë³¸ê³¼ í•¨ê»˜ íšŒì „!</strong>
            </div>
        </div>
    </div>

    <script>
        console.log('ğŸŒ ì™„ë²½í•œ ì‹¤ì œ ì§€êµ¬ë³¸ ìŠ¤í¬ë¦½íŠ¸ ì‹œì‘');
        
        // ì „ì—­ ë³€ìˆ˜
        let scene, camera, renderer, globeGroup;
        let globe, countryLines;
        let markers = [];
        let isAnimating = true;
        let showCountries = true;
        
        // ì—¬í–‰ ë°ì´í„°
        const travelData = {
            'í•œêµ­': {
                coords: [37.5665, 126.9780],
                visits: 0,
                trips: [
                    { location: 'ì„œìš¸', dates: 'ìƒì‹œ ê±°ì£¼' },
                    { location: 'ë¶€ì‚°', dates: '2024.08.11 - 08.12' },
                    { location: 'ì œì£¼ë„', dates: '2024.05.15 - 05.17' }
                ]
            },
            'ì¼ë³¸': {
                coords: [36.2048, 138.2529],
                visits: 4,
                trips: [
                    { location: 'ë„ì¿„', dates: '2023.04.11 - 04.15' },
                    { location: 'ì˜¤ì‚¬ì¹´', dates: '2023.07.11 - 07.13' },
                    { location: 'êµí† ', dates: '2024.03.20 - 03.25' },
                    { location: 'í™‹ì¹´ì´ë„', dates: '2024.12.01 - 12.05' }
                ]
            },
            'ë¯¸êµ­': {
                coords: [39.8283, -98.5795],
                visits: 2,
                trips: [
                    { location: 'ë‰´ìš•', dates: '2023.09.15 - 09.22' },
                    { location: 'ë¡œìŠ¤ì•¤ì ¤ë ˆìŠ¤', dates: '2024.06.10 - 06.17' }
                ]
            },
            'í”„ë‘ìŠ¤': {
                coords: [46.6034, 2.2137],
                visits: 3,
                trips: [
                    { location: 'íŒŒë¦¬', dates: '2023.05.20 - 05.27' },
                    { location: 'ë‹ˆìŠ¤', dates: '2024.08.15 - 08.20' },
                    { location: 'ë¦¬ì˜¹', dates: '2024.11.10 - 11.15' }
                ]
            },
            'íƒœêµ­': {
                coords: [15.8700, 100.9925],
                visits: 1,
                trips: [{ location: 'ë°©ì½•', dates: '2024.02.28 - 03.07' }]
            },
            'ì˜êµ­': {
                coords: [55.3781, -3.4360],
                visits: 1,
                trips: [{ location: 'ëŸ°ë˜', dates: '2024.09.05 - 09.12' }]
            },
            'ì´íƒˆë¦¬ì•„': {
                coords: [41.8719, 12.5674],
                visits: 1,
                trips: [{ location: 'ë¡œë§ˆ', dates: '2024.10.20 - 10.27' }]
            }
        };

        // ë°©ë¬¸ íšŸìˆ˜ë³„ ìƒ‰ìƒ
        const visitColors = {
            0: 0xff6b6b, // í•œêµ­ (ì¶œë°œì )
            1: 0x10b981, // 1íšŒ - ì´ˆë¡ìƒ‰
            2: 0xf59e0b, // 2íšŒ - ë…¸ë€ìƒ‰
            3: 0x3b82f6, // 3íšŒ - íŒŒë€ìƒ‰
            4: 0xef4444  // 4íšŒ+ - ë¹¨ê°„ìƒ‰
        };

        // ë‚˜ë¼ ê²½ê³„ì„  ë°ì´í„°
        const countryBoundaries = {
            'í•œêµ­': [
                [126.117397, 37.470782], [126.482201, 37.664519], [127.327194, 37.840827],
                [127.963028, 37.706539], [128.659363, 37.238823], [128.989594, 36.628434],
                [129.584045, 35.983674], [129.216415, 35.272748], [128.054077, 34.898942],
                [126.485291, 33.948959], [125.887375, 34.478312], [125.354004, 35.139951],
                [125.827789, 35.685289], [126.117397, 37.470782]
            ],
            'ì¼ë³¸': [
                [142.12, 45.52], [145.82, 44.12], [145.04, 42.98], [140.98, 41.25],
                [139.82, 38.95], [140.87, 37.37], [140.25, 36.05], [138.98, 34.67],
                [136.98, 33.15], [134.63, 34.15], [132.98, 33.88], [131.33, 33.08],
                [129.81, 32.79], [129.22, 31.89], [130.84, 31.51], [131.33, 30.98],
                [130.84, 30.13], [129.81, 32.79], [130.84, 33.39], [131.89, 34.02],
                [133.33, 34.67], [135.18, 35.15], [136.23, 35.65], [138.73, 36.29],
                [139.82, 37.82], [140.98, 39.25], [141.35, 41.37], [142.12, 45.52]
            ],
            'ë¯¸êµ­': [
                [-158.12, 21.54], [-155.98, 19.85], [-154.82, 18.89], [-178.35, 51.87],
                [-168.95, 65.67], [-124.73, 48.38], [-124.21, 46.19], [-122.34, 47.05],
                [-117.03, 49.00], [-95.15, 49.38], [-95.15, 28.93], [-94.04, 29.34],
                [-88.01, 30.36], [-84.32, 30.09], [-81.17, 31.34], [-80.84, 32.03],
                [-75.41, 35.75], [-71.02, 41.49], [-69.93, 44.05], [-67.79, 47.07],
                [-67.79, 45.70], [-83.23, 46.11], [-95.15, 49.38]
            ]
        };
        
        // ë¡œë”© ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateLoadingStatus(message) {
            document.getElementById('loadingStatus').textContent = message;
            console.log('ğŸ“', message);
        }

        // ì¢Œí‘œ ë³€í™˜ í•¨ìˆ˜
        function latLngToVector3(lat, lng, radius = 1) {
            const phi = (90 - lat) * (Math.PI / 180);
            const theta = (lng + 180) * (Math.PI / 180);
            
            const x = -(radius * Math.sin(phi) * Math.cos(theta));
            const z = (radius * Math.sin(phi) * Math.sin(theta));
            const y = (radius * Math.cos(phi));
            
            return new THREE.Vector3(x, y, z);
        }

        // ì‹¤ì œ ì§€êµ¬ í…ìŠ¤ì²˜ ìƒì„± (ê³ í’ˆì§ˆ)
        function createUltraRealisticEarthTexture() {
            updateLoadingStatus('ê³ í’ˆì§ˆ ì§€êµ¬ í…ìŠ¤ì²˜ ìƒì„± ì¤‘...');
            
            const canvas = document.createElement('canvas');
            canvas.width = 4096; // ë” ë†’ì€ í•´ìƒë„
            canvas.height = 2048;
            const ctx = canvas.getContext('2d');
            
            // ë°”ë‹¤ ë°°ê²½ (ë” í˜„ì‹¤ì ì¸ ê·¸ë¼ë””ì–¸íŠ¸)
            const oceanGradient = ctx.createRadialGradient(
                canvas.width / 2, canvas.height / 2, 0,
                canvas.width / 2, canvas.height / 2, canvas.height
            );
            oceanGradient.addColorStop(0, '#1e40af');   // ê¹Šì€ ë°”ë‹¤
            oceanGradient.addColorStop(0.3, '#2563eb'); // ì¤‘ê°„ ë°”ë‹¤
            oceanGradient.addColorStop(0.6, '#3b82f6'); // ì–•ì€ ë°”ë‹¤
            oceanGradient.addColorStop(0.8, '#60a5fa'); // í•´ì•ˆ ë°”ë‹¤
            oceanGradient.addColorStop(1, '#1e40af');   // ê°€ì¥ìë¦¬
            
            ctx.fillStyle = oceanGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ëŒ€ë¥™ë“¤ (ë” ì •í™•í•œ ìœ„ì¹˜ì™€ ëª¨ì–‘)
            const continents = [
                // ì•„ì‹œì•„ (í•œêµ­, ì¼ë³¸, ì¤‘êµ­ í¬í•¨)
                { x: 2400, y: 400, w: 1200, h: 600, color: '#22c55e', name: 'ì•„ì‹œì•„' },
                // ìœ ëŸ½
                { x: 1800, y: 300, w: 600, h: 400, color: '#16a34a', name: 'ìœ ëŸ½' },
                // ì•„í”„ë¦¬ì¹´  
                { x: 1900, y: 700, w: 400, h: 800, color: '#eab308', name: 'ì•„í”„ë¦¬ì¹´' },
                // ë¶ë¯¸
                { x: 400, y: 200, w: 800, h: 600, color: '#15803d', name: 'ë¶ë¯¸' },
                // ë‚¨ë¯¸
                { x: 800, y: 800, w: 300, h: 700, color: '#166534', name: 'ë‚¨ë¯¸' },
                // í˜¸ì£¼
                { x: 2800, y: 1200, w: 400, h: 200, color: '#ca8a04', name: 'í˜¸ì£¼' },
                // ë‚¨ê·¹
                { x: 0, y: 1700, w: canvas.width, h: 348, color: '#f8fafc', name: 'ë‚¨ê·¹' }
            ];
            
            continents.forEach(continent => {
                // ë” ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€ë¥™ ëª¨ì–‘
                ctx.fillStyle = continent.color;
                
                // ë³µì¡í•œ í•´ì•ˆì„  ë§Œë“¤ê¸°
                ctx.beginPath();
                const points = 50; // ë” ë§ì€ ì ìœ¼ë¡œ ë¶€ë“œëŸ¬ìš´ ê³¡ì„ 
                
                for (let i = 0; i <= points; i++) {
                    const angle = (i / points) * Math.PI * 2;
                    const radiusX = continent.w / 2;
                    const radiusY = continent.h / 2;
                    const centerX = continent.x + radiusX;
                    const centerY = continent.y + radiusY;
                    
                    // ë” ë³µì¡í•œ ë¶ˆê·œì¹™ì„±
                    const noise1 = Math.sin(angle * 5) * 0.1;
                    const noise2 = Math.sin(angle * 13) * 0.05;
                    const noise3 = Math.sin(angle * 23) * 0.02;
                    const irregularity = 0.7 + noise1 + noise2 + noise3;
                    
                    const x = centerX + Math.cos(angle) * radiusX * irregularity;
                    const y = centerY + Math.sin(angle) * radiusY * irregularity;
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                
                ctx.closePath();
                ctx.fill();
                
                // í•´ì•ˆì„  íš¨ê³¼ (ë” ì§„í•œ í…Œë‘ë¦¬)
                ctx.strokeStyle = '#0f766e';
                ctx.lineWidth = 3;
                ctx.stroke();
                
                // ë‚´ë¶€ ê·¸ë¦¼ì íš¨ê³¼
                ctx.shadowColor = 'rgba(0, 0, 0, 0.2)';
                ctx.shadowBlur = 10;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
                ctx.stroke();
                ctx.shadowColor = 'transparent';
            });
            
            // í•œêµ­ê³¼ ì¼ë³¸ ì •í™•í•œ ìœ„ì¹˜ì— ìƒì„¸ í‘œì‹œ
            ctx.fillStyle = '#dc2626';
            
            // í•œêµ­ (í•œë°˜ë„ ëª¨ì–‘ ê·¼ì‚¬)
            ctx.beginPath();
            ctx.ellipse(2640, 550, 12, 20, Math.PI * 0.15, 0, Math.PI * 2);
            ctx.fill();
            
            // ì œì£¼ë„
            ctx.beginPath();
            ctx.ellipse(2635, 580, 3, 2, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // ì¼ë³¸ (ì¼ë³¸ ì—´ë„ ëª¨ì–‘ ê·¼ì‚¬)
            ctx.beginPath();
            ctx.ellipse(2720, 540, 8, 35, Math.PI * 0.1, 0, Math.PI * 2);
            ctx.fill();
            
            // í™‹ì¹´ì´ë„
            ctx.beginPath();
            ctx.ellipse(2730, 500, 8, 8, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // ì¤‘êµ­ í‘œì‹œ (ë” ì •í™•í•œ ëª¨ì–‘)
            ctx.fillStyle = '#f97316';
            ctx.beginPath();
            ctx.ellipse(2500, 600, 80, 60, Math.PI * 0.1, 0, Math.PI * 2);
            ctx.fill();
            
            // ë¯¸êµ­ í‘œì‹œ (ë” ì •í™•í•œ ëª¨ì–‘)
            ctx.fillStyle = '#2563eb';
            ctx.beginPath();
            ctx.ellipse(700, 450, 120, 70, Math.PI * 0.05, 0, Math.PI * 2);
            ctx.fill();
            
            // ê²½ìœ„ë„ì„  (ë” ì„¸ë°€í•˜ê²Œ)
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.08)';
            ctx.lineWidth = 1;
            
            // ê²½ë„ì„  (ì„¸ë¡œì„ ) - 15ë„ ê°„ê²©
            for (let i = 0; i <= 24; i++) {
                const x = (canvas.width / 24) * i;
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            // ìœ„ë„ì„  (ê°€ë¡œì„ ) - 15ë„ ê°„ê²©
            for (let i = 0; i <= 12; i++) {
                const y = (canvas.height / 12) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
            
            // ì£¼ìš” ìœ„ë„ì„  ê°•ì¡°
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.15)';
            ctx.lineWidth = 2;
            
            // ì ë„
            ctx.beginPath();
            ctx.moveTo(0, canvas.height / 2);
            ctx.lineTo(canvas.width, canvas.height / 2);
            ctx.stroke();
            
            // ë¶íšŒê·€ì„ 
            ctx.beginPath();
            ctx.moveTo(0, canvas.height * 0.35);
            ctx.lineTo(canvas.width, canvas.height * 0.35);
            ctx.stroke();
            
            // ë‚¨íšŒê·€ì„ 
            ctx.beginPath();
            ctx.moveTo(0, canvas.height * 0.65);
            ctx.lineTo(canvas.width, canvas.height * 0.65);
            ctx.stroke();
            
            updateLoadingStatus('ê³ í’ˆì§ˆ ì§€êµ¬ í…ìŠ¤ì²˜ ìƒì„± ì™„ë£Œ');
            return new THREE.CanvasTexture(canvas);
        }

        // ë‚˜ë¼ ê²½ê³„ì„  ìƒì„±
        function createCountryBoundaries() {
            updateLoadingStatus('êµ­ê°€ ê²½ê³„ì„  ìƒì„± ì¤‘...');
            
            const countryGroup = new THREE.Group();
            
            Object.entries(countryBoundaries).forEach(([country, coordinates]) => {
                const points = coordinates.map(([lng, lat]) => {
                    return latLngToVector3(lat, lng, 1.002); // ì§€êµ¬ë³¸ë³´ë‹¤ ì•½ê°„ ìœ„ì—
                });
                
                // ë‹«íŒ ê²½ê³„ì„ ì„ ìœ„í•´ ì²« ë²ˆì§¸ ì ì„ ë§ˆì§€ë§‰ì— ì¶”ê°€
                points.push(points[0]);
                
                const geometry = new THREE.BufferGeometry().setFromPoints(points);
                const material = new THREE.LineBasicMaterial({
                    color: 0xffffff,
                    transparent: true,
                    opacity: 0.9,
                    linewidth: 3
                });
                
                const line = new THREE.Line(geometry, material);
                line.userData = { country };
                countryGroup.add(line);
            });
            
            updateLoadingStatus('êµ­ê°€ ê²½ê³„ì„  ìƒì„± ì™„ë£Œ');
            return countryGroup;
        }

        // ì§€êµ¬ë³¸ ìƒì„±
        function createGlobe() {
            updateLoadingStatus('3D ì§€êµ¬ë³¸ ë©”ì‹œ ìƒì„± ì¤‘...');
            
            const geometry = new THREE.SphereGeometry(1, 128, 128); // ë” ë†’ì€ í•´ìƒë„
            const earthTexture = createUltraRealisticEarthTexture();
            
            const material = new THREE.MeshPhongMaterial({
                map: earthTexture,
                shininess: 30,
                transparent: false,
                bumpScale: 0.02
            });
            
            const globe = new THREE.Mesh(geometry, material);
            globe.castShadow = true;
            globe.receiveShadow = true;
            
            updateLoadingStatus('3D ì§€êµ¬ë³¸ ìƒì„± ì™„ë£Œ');
            return globe;
        }

        // ë§ˆì»¤ ìƒì„± (ì§€êµ¬ë³¸ì˜ ìì‹ìœ¼ë¡œ)
        function createMarkers() {
            updateLoadingStatus('3D ì—¬í–‰ ë§ˆì»¤ ìƒì„± ì¤‘...');
            
            const markerGroup = new THREE.Group();
            markers = []; // ë°°ì—´ ì´ˆê¸°í™”
            
            Object.entries(travelData).forEach(([country, data]) => {
                const position = latLngToVector3(data.coords[0], data.coords[1], 1.08);
                
                // ë§ˆì»¤ ìƒì„± (ë” ë†’ì€ í’ˆì§ˆ)
                const geometry = new THREE.SphereGeometry(0.025, 16, 16);
                const color = visitColors[Math.min(data.visits, 4)];
                
                const material = new THREE.MeshPhongMaterial({
                    color: color,
                    emissive: color,
                    emissiveIntensity: 0.6,
                    transparent: true,
                    opacity: 0.95,
                    shininess: 100
                });
                
                const marker = new THREE.Mesh(geometry, material);
                marker.position.copy(position);
                marker.userData = { country, data };
                marker.castShadow = true;
                
                // ë°©ë¬¸ íšŸìˆ˜ì— ë”°ë¥¸ í¬ê¸° ì¡°ì •
                const scale = data.visits === 0 ? 3.5 : 2.5 + (data.visits * 0.5);
                marker.scale.setScalar(scale);
                
                markerGroup.add(marker);
                markers.push(marker);
                
                // ë§ˆì»¤ ì£¼ë³€ ë§ ìƒì„±
                const ringGeometry = new THREE.RingGeometry(0.04, 0.05, 16);
                const ringMaterial = new THREE.MeshBasicMaterial({
                    color: color,
                    transparent: true,
                    opacity: 0.7,
                    side: THREE.DoubleSide
                });
                
                const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                ring.position.copy(position);
                ring.lookAt(new THREE.Vector3(0, 0, 0));
                markerGroup.add(ring);
                
                // êµ­ê°€ ë¼ë²¨ ìƒì„± (ë§ˆì»¤ ê·¸ë£¹ì— ì¶”ê°€)
                const label = createLabel(country, position, color);
                markerGroup.add(label);
            });
            
            updateLoadingStatus('3D ì—¬í–‰ ë§ˆì»¤ ìƒì„± ì™„ë£Œ');
            return markerGroup;
        }

        // ë¼ë²¨ ìƒì„±
        function createLabel(countryName, position, color) {
            const canvas = document.createElement('canvas');
            canvas.width = 160;
            canvas.height = 40;
            const ctx = canvas.getContext('2d');
            
            // ë°°ê²½ (ë” ì„¸ë ¨ëœ ë””ìì¸)
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, 'rgba(0, 0, 0, 0.9)');
            gradient.addColorStop(1, 'rgba(0, 0, 0, 0.7)');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // í…Œë‘ë¦¬ (ê¸€ë¡œìš° íš¨ê³¼)
            const colorHex = `#${color.toString(16).padStart(6, '0')}`;
            ctx.strokeStyle = colorHex;
            ctx.lineWidth = 3;
            ctx.shadowColor = colorHex;
            ctx.shadowBlur = 8;
            ctx.strokeRect(2, 2, canvas.width-4, canvas.height-4);
            ctx.shadowBlur = 0;
            
            // í…ìŠ¤íŠ¸
            ctx.fillStyle = 'white';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.shadowColor = 'rgba(0, 0, 0, 0.8)';
            ctx.shadowBlur = 4;
            ctx.fillText(countryName, canvas.width / 2, canvas.height / 2);
            ctx.shadowBlur = 0;
            
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({
                map: texture,
                transparent: true,
                alphaTest: 0.1
            });
            
            const sprite = new THREE.Sprite(material);
            sprite.scale.set(0.3, 0.075, 1);
            
            const labelPosition = position.clone().multiplyScalar(1.18);
            sprite.position.copy(labelPosition);
            
            return sprite;
        }

        // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ ì²˜ë¦¬
        function setupMouseEvents() {
            updateLoadingStatus('ì¸í„°ë™ì…˜ ì‹œìŠ¤í…œ ì„¤ì • ì¤‘...');
            
            let isDragging = false;
            let previousMousePosition = { x: 0, y: 0 };
            
            renderer.domElement.addEventListener('mousedown', (e) => {
                isDragging = true;
                previousMousePosition = { x: e.clientX, y: e.clientY };
            });
            
            renderer.domElement.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                
                const deltaMove = {
                    x: e.clientX - previousMousePosition.x,
                    y: e.clientY - previousMousePosition.y
                };
                
                // globeGroup ì „ì²´ë¥¼ íšŒì „ (ì§€êµ¬ë³¸, ë§ˆì»¤, ë¼ë²¨ ëª¨ë‘ í•¨ê»˜)
                globeGroup.rotation.x += deltaMove.y * 0.008;
                globeGroup.rotation.y += deltaMove.x * 0.008;
                
                // íšŒì „ ë²”ìœ„ ì œí•œ (ë„ˆë¬´ ë’¤ì§‘ì–´ì§€ì§€ ì•Šê²Œ)
                globeGroup.rotation.x = Math.max(-Math.PI/2, Math.min(Math.PI/2, globeGroup.rotation.x));
                
                previousMousePosition = { x: e.clientX, y: e.clientY };
            });
            
            renderer.domElement.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            renderer.domElement.addEventListener('click', (e) => {
                if (isDragging) return;
                
                const rect = renderer.domElement.getBoundingClientRect();
                const mouse = new THREE.Vector2();
                mouse.x = ((e.clientX - rect.left) / rect.width) * 2 - 1;
                mouse.y = -((e.clientY - rect.top) / rect.height) * 2 + 1;
                
                const raycaster = new THREE.Raycaster();
                raycaster.setFromCamera(mouse, camera);
                
                // ë§ˆì»¤ë“¤ê³¼ì˜ êµì°¨ì  ê²€ì‚¬
                const intersects = raycaster.intersectObjects(markers);
                
                if (intersects.length > 0) {
                    const marker = intersects[0].object;
                    showCountryInfo(marker.userData.country, marker.userData.data);
                } else {
                    closeCountryInfo();
                }
            });
            
            renderer.domElement.addEventListener('wheel', (e) => {
                e.preventDefault();
                camera.position.z += e.deltaY * 0.002;
                camera.position.z = Math.max(2.5, Math.min(10, camera.position.z));
            });
            
            updateLoadingStatus('ì¸í„°ë™ì…˜ ì‹œìŠ¤í…œ ì„¤ì • ì™„ë£Œ');
        }

        // êµ­ê°€ ì •ë³´ í‘œì‹œ
        function showCountryInfo(country, data) {
            const countryInfo = document.getElementById('countryInfo');
            const countryName = document.getElementById('countryName');
            const tripsList = document.getElementById('tripsList');
            
            countryName.textContent = `ğŸŒ ${country} (${data.visits === 0 ? 'ì¶œë°œì ' : data.visits + 'íšŒ ë°©ë¬¸'})`;
            
            tripsList.innerHTML = '';
            data.trips.forEach((trip, index) => {
                const tripDiv = document.createElement('div');
                tripDiv.className = 'trip-item';
                tripDiv.style.animationDelay = `${index * 0.1}s`;
                tripDiv.innerHTML = `
                    <div class="trip-location">ğŸ“ ${trip.location}</div>
                    <div class="trip-date">ğŸ“… ${trip.dates}</div>
                `;
                tripsList.appendChild(tripDiv);
            });
            
            countryInfo.style.display = 'block';
            countryInfo.style.animation = 'slideInLeft 0.3s ease-out';
        }

        // êµ­ê°€ ì •ë³´ ë‹«ê¸°
        function closeCountryInfo() {
            const countryInfo = document.getElementById('countryInfo');
            countryInfo.style.animation = 'slideOutLeft 0.3s ease-in';
            setTimeout(() => {
                countryInfo.style.display = 'none';
            }, 300);
        }

        // ë³„ ë°°ê²½ ìƒì„±
        function createStarField() {
            updateLoadingStatus('ìš°ì£¼ ë°°ê²½ ìƒì„± ì¤‘...');
            
            const starGeometry = new THREE.BufferGeometry();
            const starMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.7,
                transparent: true,
                opacity: 0.9,
                sizeAttenuation: false
            });
            
            const starVertices = [];
            const starColors = [];
            
            for (let i = 0; i < 3000; i++) {
                // ë³„ì˜ ìœ„ì¹˜ (êµ¬ í˜•íƒœë¡œ ë°°ì¹˜)
                const radius = 50 + Math.random() * 50;
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.random() * Math.PI;
                
                const x = radius * Math.sin(phi) * Math.cos(theta);
                const y = radius * Math.sin(phi) * Math.sin(theta);
                const z = radius * Math.cos(phi);
                
                starVertices.push(x, y, z);
                
                // ë³„ì˜ ìƒ‰ìƒ (ì•½ê°„ì˜ ë³€í™”)
                const brightness = 0.5 + Math.random() * 0.5;
                starColors.push(brightness, brightness, brightness);
            }
            
            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            starGeometry.setAttribute('color', new THREE.Float32BufferAttribute(starColors, 3));
            
            const stars = new THREE.Points(starGeometry, starMaterial);
            return stars;
        }

        // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
        function animate() {
            requestAnimationFrame(animate);
            
            if (isAnimating && globeGroup) {
                // ì „ì²´ ê·¸ë£¹ì„ íšŒì „ (ë§ˆì»¤ë“¤ë„ í•¨ê»˜)
                globeGroup.rotation.y += 0.002;
                
                // ë§ˆì»¤ í„ìŠ¤ íš¨ê³¼
                markers.forEach((marker, index) => {
                    const time = Date.now() * 0.001 + index * 0.3;
                    const pulseFactor = 1 + Math.sin(time * 4) * 0.15;
                    const baseScale = marker.userData.data.visits === 0 ? 3.5 : 2.5 + (marker.userData.data.visits * 0.5);
                    marker.scale.setScalar(baseScale * pulseFactor);
                });
            }
            
            renderer.render(scene, camera);
        }

        // ì»¨íŠ¸ë¡¤ í•¨ìˆ˜ë“¤
        function resetView() {
            if (camera && globeGroup) {
                // ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ ì›ë˜ ìœ„ì¹˜ë¡œ
                const targetPosition = { x: 0, y: 0, z: 4 };
                const targetRotation = { x: 0, y: 0, z: 0 };
                
                // ê°„ë‹¨í•œ ì• ë‹ˆë©”ì´ì…˜
                const duration = 1000; // 1ì´ˆ
                const startTime = Date.now();
                const startCameraZ = camera.position.z;
                const startRotationX = globeGroup.rotation.x;
                const startRotationY = globeGroup.rotation.y;
                
                function animateReset() {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const easeProgress = 1 - Math.pow(1 - progress, 3); // easeOut
                    
                    camera.position.z = startCameraZ + (targetPosition.z - startCameraZ) * easeProgress;
                    globeGroup.rotation.x = startRotationX + (targetRotation.x - startRotationX) * easeProgress;
                    globeGroup.rotation.y = startRotationY + (targetRotation.y - startRotationY) * easeProgress;
                    
                    if (progress < 1) {
                        requestAnimationFrame(animateReset);
                    }
                }
                
                animateReset();
            }
        }

        function toggleAnimation() {
            isAnimating = !isAnimating;
            const btn = document.getElementById('animationBtn');
            btn.textContent = isAnimating ? 'â¸ï¸ ì •ì§€' : 'â–¶ï¸ íšŒì „';
            btn.style.background = isAnimating ? 
                'linear-gradient(135deg, #ef4444, #dc2626)' : 
                'linear-gradient(135deg, #22c55e, #16a34a)';
        }
        
        function toggleCountries() {
            if (countryLines) {
                countryLines.visible = !countryLines.visible;
                showCountries = countryLines.visible;
                const btn = document.getElementById('countryBtn');
                btn.textContent = showCountries ? 'ğŸ—ºï¸ ê²½ê³„ì„ ' : 'ğŸŒ ì§€êµ¬ë³¸';
                btn.style.background = showCountries ? 
                    'linear-gradient(135deg, #8b5cf6, #7c3aed)' : 
                    'linear-gradient(135deg, #06b6d4, #0891b2)';
            }
        }

        // ì´ˆê¸°í™”
        function init() {
            updateLoadingStatus('Three.js ì—”ì§„ ì´ˆê¸°í™” ì¤‘...');
            
            try {
                // Scene ìƒì„±
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x000008); // ë” ì–´ë‘ìš´ ìš°ì£¼ ë°°ê²½

                // Camera ìƒì„±
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.set(0, 0, 4);

                // Renderer ìƒì„± (ê³ í’ˆì§ˆ ì„¤ì •)
                renderer = new THREE.WebGLRenderer({ 
                    antialias: true,
                    alpha: false,
                    powerPreference: "high-performance"
                });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                renderer.outputEncoding = THREE.sRGBEncoding;
                renderer.toneMapping = THREE.ACESFilmicToneMapping;
                renderer.toneMappingExposure = 1.2;
                
                document.getElementById('container').appendChild(renderer.domElement);

                updateLoadingStatus('ê³ ê¸‰ ì¡°ëª… ì‹œìŠ¤í…œ ì„¤ì • ì¤‘...');
                
                // ì¡°ëª… ì„¤ì • (ë” í˜„ì‹¤ì ìœ¼ë¡œ)
                const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
                scene.add(ambientLight);

                // íƒœì–‘ê´‘ (ì£¼ ì¡°ëª…)
                const sunLight = new THREE.DirectionalLight(0xffffff, 1.5);
                sunLight.position.set(8, 5, 8);
                sunLight.castShadow = true;
                sunLight.shadow.mapSize.width = 2048;
                sunLight.shadow.mapSize.height = 2048;
                sunLight.shadow.camera.near = 0.5;
                sunLight.shadow.camera.far = 500;
                scene.add(sunLight);

                // ë°˜ì‚¬ê´‘ (ì§€êµ¬ ë°˜ëŒ€í¸)
                const moonLight = new THREE.DirectionalLight(0x6366f1, 0.4);
                moonLight.position.set(-8, -3, -8);
                scene.add(moonLight);

                // í¬ì¸íŠ¸ ë¼ì´íŠ¸ (ëŒ€ê¸°ê¶Œ íš¨ê³¼)
                const atmosphereLight = new THREE.PointLight(0x60a5fa, 0.6, 20);
                atmosphereLight.position.set(0, 0, 3);
                scene.add(atmosphereLight);

                updateLoadingStatus('ì§€êµ¬ë³¸ ì‹œìŠ¤í…œ êµ¬ì¶• ì¤‘...');

                // ê¸€ë¡œë¸Œ ê·¸ë£¹ ìƒì„± (ëª¨ë“  ê²ƒì„ ë‹´ì„ ì»¨í…Œì´ë„ˆ)
                globeGroup = new THREE.Group();
                scene.add(globeGroup);
                
                // ì§€êµ¬ë³¸ ìƒì„± ë° ì¶”ê°€
                globe = createGlobe();
                globeGroup.add(globe);
                
                // êµ­ê°€ ê²½ê³„ì„  ìƒì„± ë° ì¶”ê°€
                countryLines = createCountryBoundaries();
                globeGroup.add(countryLines);
                
                // ë§ˆì»¤ ìƒì„± ë° ì¶”ê°€
                const markerGroup = createMarkers();
                globeGroup.add(markerGroup);

                // ë³„ ë°°ê²½ ì¶”ê°€
                const stars = createStarField();
                scene.add(stars);

                // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ ì„¤ì •
                setupMouseEvents();

                updateLoadingStatus('ìµœì¢… ì„¤ì • ì¤‘...');
                
                // ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
                animate();
                
                updateLoadingStatus('ğŸ‰ ì™„ë²½í•œ ì‹¤ì œ ì§€êµ¬ë³¸ ì™„ì„±!');
                
                // ë¡œë”© í™”ë©´ ì„œì„œíˆ ì‚¬ë¼ì§€ê¸°
                setTimeout(() => {
                    const loading = document.getElementById('loading');
                    loading.style.transition = 'opacity 0.8s ease-out';
                    loading.style.opacity = '0';
                    setTimeout(() => {
                        loading.style.display = 'none';
                    }, 800);
                }, 1500);
                
            } catch (error) {
                console.error('âŒ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                document.getElementById('loadingStatus').innerHTML = `
                    <div style="color: #ef4444;">
                        <strong>ì˜¤ë¥˜ ë°œìƒ!</strong><br>
                        ${error.message}<br>
                        ë¸Œë¼ìš°ì €ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.
                    </div>
                `;
            }
        }

        // ì°½ í¬ê¸° ë³€ê²½ ì²˜ë¦¬
        window.addEventListener('resize', () => {
            if (camera && renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        });

        // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ CSS ì¶”ê°€
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInLeft {
                from { transform: translateX(-100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutLeft {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(-100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Three.js ë¡œë“œ í™•ì¸ í›„ ì´ˆê¸°í™”
        if (typeof THREE !== 'undefined') {
            console.log('ğŸš€ Three.js ë¡œë“œ ì™„ë£Œ, ì™„ë²½í•œ ì‹¤ì œ ì§€êµ¬ë³¸ ì´ˆê¸°í™” ì‹œì‘');
            init();
        } else {
            console.error('âŒ Three.js ë¡œë“œ ì‹¤íŒ¨');
            document.getElementById('loadingStatus').innerHTML = `
                <div style="color: #ef4444;">
                    <strong>Three.js ë¡œë“œ ì‹¤íŒ¨!</strong><br>
                    ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê³  ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.
                </div>
            `;
        }

    </script>
</body>
</html>